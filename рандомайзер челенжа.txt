<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–µ–Ω–Ω—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–µ–ª–ª–µ–Ω–¥–∂–µ–π Arena Breakout</title>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏ */
        #historyList::-webkit-scrollbar {
            width: 8px;
        }
        #historyList::-webkit-scrollbar-track {
            background: #2d3748; /* bg-gray-800 */
            border-radius: 10px;
        }
        #historyList::-webkit-scrollbar-thumb {
            background: #f6ad55; /* text-orange-400 */
            border-radius: 10px;
        }
        #historyList::-webkit-scrollbar-thumb:hover {
            background: #ed8936; /* text-orange-500 */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans p-4 sm:p-8">

    <!-- 
      Chosen Palette: "Muted Military" - A dark theme using bg-gray-900 (primary background), bg-gray-800 (card backgrounds), text-gray-200 (primary text), with text-yellow-500 and bg-orange-600 as high-contrast military-style accents for buttons and titles.
      
      Application Structure Plan: The application is structured as a single-page dashboard. The user flow is centered on a single "Generate" button. 
      1.  Header: Title.
      2.  Controls: A row with "Generate" and "Save" buttons.
      3.  Timer: Prominently displayed below controls.
      4.  Main Display (`#challengeDisplay`): A responsive 3-column grid that displays the entire challenge as 9 distinct "info cards" (Helmet, Vest, Rig, Weapon, Ammo, Meds, Grenade, Map, Task). This card-based structure is far more scannable and user-friendly than a single text block.
      5.  History Section: A collapsible or scrollable list below the main display to review past challenges.
      This structure was chosen because the user needs to see 9 distinct pieces of information at once. A grid of cards is the most effective way to present this "loadout" clearly and modularly, especially on mobile devices (where it stacks to a single column).

      Visualization & Content Choices:
      -   Report Info: Helmet, Vest, Rig, Weapon, Ammo, Meds, Grenade, Map, Task, Difficulty.
      -   Goal: Inform the user of their randomized loadout and mission.
      -   Viz/Presentation: "Info Cards" created with structured HTML/Tailwind. Each card displays a category (e.g., "–®–õ–ï–ú"), an image (placeholder or map), the item's name (e.g., "6–ë4–¢"), and key stats (e.g., "–¢–∏—Ä: 4").
      -   Interaction: 
          1.  "Generate" Button Click: Triggers JS to randomly select one item from each data array, *ensuring* ammo matches the weapon. It then builds and injects the 9 HTML cards into the `#challengeDisplay` grid. Starts a 3-minute timer.
          2.  "Save" Button Click: Serializes the *data* (not the HTML) of the current challenge into a JSON object and saves it to localStorage. It then re-renders the history list.
      -   Justification: This card-based UI is visually appealing, modular, and scales perfectly from mobile to desktop. Separating the data (JS objects) from the presentation (HTML-generating functions) is a robust software design pattern that makes the app easier to maintain and update. The timer adds the requested pressure.
      -   Library/Method: Tailwind CSS for layout, Vanilla JS for all logic and DOM manipulation.

      CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->

    <div class="container mx-auto max-w-7xl">

        <h1 class="text-3xl sm:text-4xl font-bold text-center text-orange-500 uppercase tracking-wider" style="text-shadow: 2px 2px 4px #000;">
            üî´ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ß–µ–ª–ª–µ–Ω–¥–∂–µ–π Arena Breakout
        </h1>

        <div class="flex flex-col sm:flex-row justify-center gap-4 my-6">
            <button onclick="generateChallenge()" class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-all duration-200 transform hover:scale-105 text-lg uppercase">
                üéØ –ù–æ–≤–æ–µ –ó–∞–¥–∞–Ω–∏–µ
            </button>
            <button onclick="saveChallenge()" class="bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold py-3 px-8 rounded-lg shadow-md transition-all duration-200 text-lg uppercase">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
        </div>

        <div id="timerContainer" class="text-center my-6" style="display: none;">
            <h2 id="timerLabel" class="text-2xl font-semibold text-yellow-400">
                –¢–∞–π–º–µ—Ä –ó–∞–¥–∞–Ω–∏—è: <span id="timer" class="text-4xl font-mono block sm:inline-block mt-1 sm:mt-0">03:00</span>
            </h2>
        </div>

        <audio id="startSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
        <audio id="endSound" src="https://actions.google.com/sounds/v1/alarms/laser_shoot.ogg" preload="auto"></audio>

        <!-- –ó–æ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ–ª–ª–µ–Ω–¥–∂–∞ -->
        <div id="challengeDisplay" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
            <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-6 flex flex-col items-center justify-center text-center min-h-[280px]">
                <span class="text-5xl mb-4">üîß</span>
                <h3 class="text-xl font-semibold text-yellow-500">–ì–æ—Ç–æ–≤ –∫ –∑–∞–¥–∞–Ω–∏—é?</h3>
                <p class="text-gray-400 mt-2">–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–ù–æ–≤–æ–µ –ó–∞–¥–∞–Ω–∏–µ", —á—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–ª–µ–¥—É—é—â–∏–π —Ä–µ–π–¥.</p>
            </div>
        </div>

        <!-- –ò—Å—Ç–æ—Ä–∏—è -->
        <div id="history" class="mt-12 max-w-5xl mx-auto">
            <h2 class="text-2xl font-bold text-center text-orange-500 mb-4 uppercase">üìù –ò—Å—Ç–æ—Ä–∏—è –ó–∞–¥–∞–Ω–∏–π</h2>
            <div id="historyList" class="max-h-80 overflow-y-auto space-y-3 p-4 bg-gray-800/70 backdrop-blur-sm rounded-lg border border-gray-700">
                <p class="text-gray-400 text-center">–ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å.</p>
            </div>
        </div>

    </div>

    <script>
        // =====================================================================
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        // =====================================================================
        
        let timerInterval = null;
        let currentChallengeData = {};
        const HISTORY_KEY = 'arenaChallengeHistory_v1';

        // =====================================================================
        // –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (DATA)
        // =====================================================================

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç URL –¥–ª—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
         * @param {string} text - –¢–µ–∫—Å—Ç –Ω–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–µ
         * @param {number} w - –®–∏—Ä–∏–Ω–∞
         * @param {number} h - –í—ã—Å–æ—Ç–∞
         * @returns {string} URL
         */
        const placeholderImg = (text, w = 150, h = 150) => `https://placehold.co/${w}x${h}/4A5568/E2E8F0?text=${encodeURIComponent(text)}`;

        const data = {
            helmets: [
                { name: "–¢–ö-200", tier: 2, img: placeholderImg('–¢–ö-200') },
                { name: "–®-9", tier: 3, img: placeholderImg('–®-9') },
                { name: "–®–ª–µ–º 6–ë4–¢", tier: 4, img: placeholderImg('6–ë4–¢') },
                { name: "–ê–ù-95", tier: 5, img: placeholderImg('–ê–ù-95') },
                { name: "H-Tac", tier: 6, img: placeholderImg('H-Tac') },
                { name: "–ë–µ–∑ –®–ª–µ–º–∞", tier: 0, img: placeholderImg('–ù–µ—Ç –®–ª–µ–º–∞') }
            ],
            vests: [ // –ë—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç—ã
                { name: "–ë–ù-2 (–¢–∏–ø 3)", tier: 3, img: placeholderImg('–ë–ù-2') },
                { name: "6–ë13", tier: 4, img: placeholderImg('6–ë13') },
                { name: "6–ë23", tier: 4, img: placeholderImg('6–ë23') },
                { name: "–ö–ê-6", tier: 5, img: placeholderImg('–ö–ê-6') },
                { name: "BT-201 (–ö–æ—Ä—É–Ω–¥)", tier: 5, img: placeholderImg('BT-201') },
                { name: "–ö–æ–º–º–∞–Ω–¥–æ—Å", tier: 6, img: placeholderImg('–ö–æ–º–º–∞–Ω–¥–æ—Å') },
                { name: "–ë–µ–∑ –ë—Ä–æ–Ω–∏", tier: 0, img: placeholderImg('–ù–µ—Ç –ë—Ä–æ–Ω–∏') }
            ],
            rigs: [ // –†–∞–∑–≥—Ä—É–∑–∫–∏
                { name: "–†–∞–∑–≥—Ä—É–∑–∫–∞ BH-2", slots: "6", img: placeholderImg('BH-2') },
                { name: "–¢–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ö–ê-10", slots: "8", img: placeholderImg('–ö–ê-10') },
                { name: "–†–∞–∑–≥—Ä—É–∑–∫–∞ '–°–∫–∞—É—Ç'", slots: "10", img: placeholderImg('–°–∫–∞—É—Ç') },
                { name: "–¢—è–∂–µ–ª–∞—è '–î–∂–∞–≥–≥–µ—Ä–Ω–∞—É—Ç'", slots: "12", img: placeholderImg('–î–∂–∞–≥–≥–µ—Ä–Ω–∞—É—Ç') },
                { name: "–ù–µ—Ç –†–∞–∑–≥—Ä—É–∑–∫–∏ (–¢–æ–ª—å–∫–æ —Ä—é–∫–∑–∞–∫)", slots: "0", img: placeholderImg('–ù–µ—Ç –†–∞–∑–≥—Ä—É–∑–∫–∏') }
            ],
            weapons: [
                {
                    name: "–ê–ö-74–ù",
                    type: "–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞",
                    img: placeholderImg('–ê–ö-74–ù'),
                    ammo: [
                        { name: "5.45x39 –ü–°", tier: 2, img: placeholderImg('5.45 –ü–°') },
                        { name: "5.45x39 –ë–ü", tier: 4, img: placeholderImg('5.45 –ë–ü') },
                        { name: "5.45x39 –ë–°", tier: 5, img: placeholderImg('5.45 –ë–°') }
                    ]
                },
                {
                    name: "M4A1",
                    type: "–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞",
                    img: placeholderImg('M4A1'),
                    ammo: [
                        { name: "5.56x45 M855", tier: 3, img: placeholderImg('M855') },
                        { name: "5.56x45 M855A1", tier: 4, img: placeholderImg('M855A1') },
                        { name: "5.56x45 M995", tier: 5, img: placeholderImg('M995') }
                    ]
                },
                {
                    name: "FAL",
                    type: "–®—Ç—É—Ä–º–æ–≤–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞",
                    img: placeholderImg('FAL'),
                    ammo: [
                        { name: "7.62x51 M80", tier: 4, img: placeholderImg('M80') },
                        { name: "7.62x51 M62", tier: 5, img: placeholderImg('M62') },
                        { name: "7.62x51 M993", tier: 6, img: placeholderImg('M993') }
                    ]
                },
                {
                    name: "Mosin",
                    type: "–°–Ω–∞–π–ø–µ—Ä—Å–∫–∞—è –≤–∏–Ω—Ç–æ–≤–∫–∞",
                    img: placeholderImg('Mosin'),
                    ammo: [
                        { name: "7.62x54R –¢-46", tier: 3, img: placeholderImg('–¢-46') },
                        { name: "7.62x54R –õ–ü–°", tier: 4, img: placeholderImg('–õ–ü–°') },
                        { name: "7.62x54R –°–ù–ë", tier: 6, img: placeholderImg('–°–ù–ë') }
                    ]
                },
                {
                    name: "MP5",
                    type: "–ü–∏—Å—Ç–æ–ª–µ—Ç-–ø—É–ª–µ–º–µ—Ç",
                    img: placeholderImg('MP5'),
                    ammo: [
                        { name: "9x19 PST", tier: 2, img: placeholderImg('9x19 PST') },
                        { name: "9x19 AP 6.3", tier: 3, img: placeholderImg('AP 6.3') },
                        { name: "9x19 7N31", tier: 4, img: placeholderImg('7N31') }
                    ]
                },
                {
                    name: "SKS",
                    type: "–ö–∞—Ä–∞–±–∏–Ω",
                    img: placeholderImg('SKS'),
                    ammo: [
                        { name: "7.62x39 –ü–°", tier: 3, img: placeholderImg('7.62 –ü–°') },
                        { name: "7.62x39 –ë–ü", tier: 5, img: placeholderImg('7.62 –ë–ü') }
                    ]
                },
                {
                    name: "M870",
                    type: "–î—Ä–æ–±–æ–≤–∏–∫",
                    img: placeholderImg('M870'),
                    ammo: [
                        { name: "12–∫ –î—Ä–æ–±—å #7", tier: 1, img: placeholderImg('–î—Ä–æ–±—å #7') },
                        { name: "12–∫ '–§–ª–µ—à–µ—Ç—Ç–∞'", tier: 3, img: placeholderImg('–§–ª–µ—à–µ—Ç—Ç–∞') },
                        { name: "12–∫ AP-20", tier: 4, img: placeholderImg('AP-20') }
                    ]
                },
                {
                    name: "Glock 17",
                    type: "–ü–∏—Å—Ç–æ–ª–µ—Ç",
                    img: placeholderImg('Glock 17'),
                    ammo: [
                        { name: "9x19 PST", tier: 2, img: placeholderImg('9x19 PST') },
                        { name: "9x19 AP 6.3", tier: 3, img: placeholderImg('AP 6.3') }
                    ]
                }
            ],
            meds: [
                { name: "–ü—Ä–æ—Å—Ç–æ–π –±–∏–Ω—Ç", type: "–õ–µ—á–µ–Ω–∏–µ", img: placeholderImg('–ë–∏–Ω—Ç') },
                { name: "–í–æ–µ–Ω–Ω—ã–π –±–∏–Ω—Ç", type: "–õ–µ—á–µ–Ω–∏–µ", img: placeholderImg('–í–æ–µ–Ω. –ë–∏–Ω—Ç') },
                { name: "–ê–ø—Ç–µ—á–∫–∞ (–°—Ç–∞–Ω–¥.)", type: "–õ–µ—á–µ–Ω–∏–µ", img: placeholderImg('–ê–ø—Ç–µ—á–∫–∞') },
                { name: "–í–æ–µ–Ω–Ω–∞—è –∞–ø—Ç–µ—á–∫–∞", type: "–õ–µ—á–µ–Ω–∏–µ", img: placeholderImg('–í–æ–µ–Ω. –ê–ø—Ç–µ—á–∫–∞') },
                { name: "–•–∏—Ä—É—Ä. –Ω–∞–±–æ—Ä (–ü—Ä–æ—Å—Ç.)", type: "–•–∏—Ä—É—Ä–≥–∏—è", img: placeholderImg('–•–∏—Ä—É—Ä–≥. –ü—Ä–æ—Å—Ç.') },
                { name: "–•–∏—Ä—É—Ä. –Ω–∞–±–æ—Ä (–°—Ç–∞–Ω–¥.)", type: "–•–∏—Ä—É—Ä–≥–∏—è", img: placeholderImg('–•–∏—Ä—É—Ä–≥. –°—Ç–∞–Ω–¥.') },
                { name: "–û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–µ–µ (–¢–∞–±–ª.)", type: "–ë–æ–ª—å", img: placeholderImg('–¢–∞–±–ª–µ—Ç–∫–∏') }
            ],
            grenades: [
                { name: "–û—Å–∫–æ–ª–æ—á–Ω–∞—è –ú67", type: "–û—Å–∫–æ–ª–æ—á–Ω–∞—è", img: placeholderImg('–ú67') },
                { name: "–û—Å–∫–æ–ª–æ—á–Ω–∞—è GHO-2", type: "–û—Å–∫–æ–ª–æ—á–Ω–∞—è", img: placeholderImg('GHO-2') },
                { name: "–î—ã–º–æ–≤–∞—è –ú18", type: "–î—ã–º", img: placeholderImg('–ú18') },
                { name: "–°–≤–µ—Ç–æ—à—É–º–æ–≤–∞—è M84", type: "–°–≤–µ—Ç", img: placeholderImg('M84') }
            ],
            maps: [
                { name: "–§–µ—Ä–º–∞", img: "https://static.wikia.nocookie.net/arena-breakout/images/4/4b/Farm_EN_Map.webp/revision/latest?cb=20240321151656" },
                { name: "–î–æ–ª–∏–Ω–∞", img: "https://static.wikia.nocookie.net/arena-breakout/images/c/c1/Valley_EN_Map.webp/revision/latest?cb=20240321151745" },
                { name: "–ù–æ—Ä—Ç—Ä–∏–¥–∂", img: "https://static.wikia.nocookie.net/arena-breakout/images/e/e4/Northridge_EN_Map.webp/revision/latest?cb=20240321151727" },
                { name: "–ü–æ—Ä—Ç", img: "https://static.wikia.nocookie.net/arena-breakout/images/a/a2/Port_EN_Map.webp/revision/latest?cb=20240321151713" },
                { name: "–ó–∞–ª–∏–≤ –ì—É–∞—è–ø–æ—Å", img: "https://static.wikia.nocookie.net/arena-breakout-infinite/images/f/f0/Guoyapos_Bay_Map.png/revision/latest?cb=20240510164807" },
                { name: "–¢–í –°—Ç–∞–Ω—Ü–∏—è", img: "https://static.wikia.nocookie.net/arena-breakout/images/5/52/TV_Station_EN_Map.webp/revision/latest?cb=20240321151737" }
            ],
            tasks: [
                { title: "–ß–∞–¥-–†–∞–Ω ‚öîÔ∏è", desc: "–í–∞—à–∞ —Ü–µ–ª—å - —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–∏. –£–±–µ–π—Ç–µ –∫–∞–∫ –º–∏–Ω–∏–º—É–º 2 –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∏–∫–æ–≤ –∏ —ç–≤–∞–∫—É–∏—Ä—É–π—Ç–µ—Å—å." },
                { title: "–ö—Ä—ã—Å–∏–Ω—ã–π –†–µ–π–¥ üêÄ", desc: "–ù–µ –≤—Å—Ç—É–ø–∞—Ç—å –≤ –±–æ–π. –í–∞—à–∞ —Ü–µ–ª—å - —Å–æ–±—Ä–∞—Ç—å –ª—É—Ç –Ω–∞ 150,000 –ö–æ—ç–Ω –∏ —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞—Ç—å—Å—è –∂–∏–≤—ã–º." },
                { title: "–¢–æ–ª—å–∫–æ –æ–¥–Ω–∞... ‚òùÔ∏è", desc: "–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ –û–î–ù–û –æ—Ä—É–∂–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∞–º –≤—ã–ø–∞–ª–æ. –ù–∏–∫–∞–∫–æ–≥–æ –≤—Ç–æ—Ä–æ–≥–æ —Å–ª–æ—Ç–∞ –∏–ª–∏ –ø–∏—Å—Ç–æ–ª–µ—Ç–∞." },
                { title: "–ë–æ—Å—Å-–•–∞–Ω—Ç–µ—Ä üëë", desc: "–ù–∞–π–¥–∏—Ç–µ –∏ —É–Ω–∏—á—Ç–æ–∂—å—Ç–µ –±–æ—Å—Å–∞ –Ω–∞ —ç—Ç–æ–π –∫–∞—Ä—Ç–µ (–∏–ª–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–∏–Ω—å–æ–Ω–∞). –ó–∞–±–µ—Ä–∏—Ç–µ –µ–≥–æ –ª—É—á—à–∏–π –ª—É—Ç." },
                { title: "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å üó∫Ô∏è", desc: "–ü–æ—Å–µ—Ç–∏—Ç–µ 3 '–∫–ª—é—á–µ–≤—ã—Ö' (–∫—Ä–∞—Å–Ω—ã—Ö) —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ –∏ —ç–≤–∞–∫—É–∏—Ä—É–π—Ç–µ—Å—å." },
                { title: "–ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞ üíº", desc: "–ù–∞–π–¥–∏—Ç–µ –∏ –≤—ã–Ω–µ—Å–∏—Ç–µ 1 '–°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç' –∏–ª–∏ –ª—é–±–æ–π '–ó–æ–ª–æ—Ç–æ–π' –ø—Ä–µ–¥–º–µ—Ç." },
                { title: "–°–Ω–∞–π–ø–µ—Ä üéØ", desc: "–£–±–µ–π—Ç–µ 5 –≤—Ä–∞–≥–æ–≤ (–ò–≥—Ä–æ–∫–æ–≤ –∏–ª–∏ –ë–æ—Ç–æ–≤) –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏ –≤ –≥–æ–ª–æ–≤—É —Å –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –±–æ–ª–µ–µ 50 –º–µ—Ç—Ä–æ–≤." },
                { title: "–ë–µ–∑ –ë—Ä–æ–Ω–∏ naked", desc: "–°–Ω–∏–º–∏—Ç–µ –≤—ã–ø–∞–≤—à–∏–π –≤–∞–º —à–ª–µ–º –∏ –±—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç. –ü—Ä–æ–π–¥–∏—Ç–µ —Ä–µ–π–¥ –±–µ–∑ –Ω–∏—Ö (–†–∞–∑–≥—Ä—É–∑–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞)." },
                { title: "–ó–∞–ø–∞—Å–ª–∏–≤—ã–π –•–æ–º—è–∫ üéí", desc: "–í—ã –¥–æ–ª–∂–Ω—ã —ç–≤–∞–∫—É–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –ü–û–õ–ù–´–ú —Ä—é–∫–∑–∞–∫–æ–º –∏ —Ä–∞–∑–≥—Ä—É–∑–∫–æ–π. –ö–∞–∂–¥—ã–π —Å–ª–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–Ω—è—Ç." },
                { title: "–ú–∞—Ä–æ–¥–µ—Ä ‚ò†Ô∏è", desc: "–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ (–æ—Ä—É–∂–∏–µ, –±—Ä–æ–Ω—è), –Ω–∞–π–¥–µ–Ω–Ω–æ–µ –í –†–ï–ô–î–ï. –í–∞—à–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ - —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –≤–Ω–∞—á–∞–ª–µ." }
            ],
            difficulty: ["–ë–µ–ª–∞—è –ó–æ–Ω–∞ (–û–±—ã—á–Ω–∞—è)", "–ñ–µ–ª—Ç–∞—è –ó–æ–Ω–∞ (–°–æ–±—ã—Ç–∏–µ)", "–ö—Ä–∞—Å–Ω–∞—è –ó–æ–Ω–∞ (–ë–ª–æ–∫–∞–¥–∞)"]
        };

        // =====================================================================
        // –õ–æ–≥–∏–∫–∞ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        // =====================================================================

        /**
         * –ü–æ–ª—É—á–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞
         * @param {Array<any>} arr - –ú–∞—Å—Å–∏–≤
         * @returns {any} –°–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
         */
        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ —á–µ–ª–ª–µ–Ω–¥–∂–∞
         * @param {string} title - –ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä. "–®–õ–ï–ú")
         * @param {string} name - –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
         * @param {string} stat - –î–æ–ø. —Å—Ç–∞—Ç (–Ω–∞–ø—Ä. "–¢–∏—Ä: 4")
         * @param {string} imgUrl - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
         * @param {string} [desc] - –û–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è –∫–∞—Ä—Ç –∏ –∑–∞–¥–∞–Ω–∏–π)
         * @param {boolean} [isMap=false] - –§–ª–∞–≥ –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
         */
        function buildChallengeCard(title, name, stat, imgUrl, desc = '', isMap = false) {
            const imgClass = isMap 
                ? 'w-full h-48 object-cover rounded-md mb-3 bg-gray-700' 
                : 'w-36 h-36 object-contain rounded-md mb-3';
            
            const mapErrorFallback = placeholderImg(`${name}?`, 300, 200);

            return `
                <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-4 flex flex-col items-center text-center transition-all duration-300 hover:shadow-xl hover:border-yellow-500 min-h-[320px] justify-between">
                    <div>
                        <h3 class="text-sm font-semibold text-yellow-500 uppercase tracking-wider mb-2">${title}</h3>
                        <img src="${imgUrl}" alt="${name}" class="${imgClass}" ${isMap ? `onerror="this.onerror=null; this.src='${mapErrorFallback}'"` : ''}>
                        <h4 class="text-lg font-bold text-white">${name}</h4>
                        <p class="text-base text-gray-400">${stat}</p>
                    </div>
                    ${desc ? `<p class="text-sm text-gray-300 mt-2">${desc}</p>` : ''}
                </div>
            `;
        }

        /**
         * –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
         */
        function generateChallenge() {
            // 1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–π —Ç–∞–π–º–µ—Ä
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }

            // 2. –í—ã–±–∏—Ä–∞–µ–º —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ
            const helmet = getRandomItem(data.helmets);
            const vest = getRandomItem(data.vests);
            const rig = getRandomItem(data.rigs);
            const weapon = getRandomItem(data.weapons);
            const ammo = getRandomItem(weapon.ammo); // –ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞: –ø–∞—Ç—Ä–æ–Ω—ã –∏–∑ –æ—Ä—É–∂–∏—è
            const med = getRandomItem(data.meds);
            const grenade = getRandomItem(data.grenades);
            const map = getRandomItem(data.maps);
            const task = getRandomItem(data.tasks);
            const difficulty = getRandomItem(data.difficulty);

            // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
            currentChallengeData = { helmet, vest, rig, weapon, ammo, med, grenade, map, task, difficulty };
            
            // 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML
            const display = document.getElementById('challengeDisplay');
            let challengeHTML = '';

            challengeHTML += buildChallengeCard('–®–ª–µ–º', helmet.name, `–¢–∏—Ä: ${helmet.tier}`, helmet.img);
            challengeHTML += buildChallengeCard('–ë—Ä–æ–Ω–µ–∂–∏–ª–µ—Ç', vest.name, `–¢–∏—Ä: ${vest.tier}`, vest.img);
            challengeHTML += buildChallengeCard('–†–∞–∑–≥—Ä—É–∑–∫–∞', rig.name, `–°–ª–æ—Ç–æ–≤: ${rig.slots}`, rig.img);
            challengeHTML += buildChallengeCard('–û—Ä—É–∂–∏–µ', weapon.name, weapon.type, weapon.img);
            challengeHTML += buildChallengeCard('–ü–∞—Ç—Ä–æ–Ω—ã', ammo.name, `–ü—Ä–æ–±–∏—Ç–∏–µ (–¢–∏—Ä): ${ammo.tier}`, ammo.img);
            challengeHTML += buildChallengeCard('–ú–µ–¥–∏—Ü–∏–Ω–∞', med.name, med.type, med.img);
            challengeHTML += buildChallengeCard('–ì—Ä–∞–Ω—Ç–∞', grenade.name, grenade.type, grenade.img);
            challengeHTML += buildChallengeCard('–ö–∞—Ä—Ç–∞', map.name, difficulty, map.img, '', true);
            challengeHTML += buildChallengeCard('–ó–∞–¥–∞–Ω–∏–µ', task.title, '', placeholderImg(task.title, 150, 150), task.desc);

            display.innerHTML = challengeHTML;

            // 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startTimer(180); // 180 —Å–µ–∫—É–Ω–¥ = 3 –º–∏–Ω
        }

        /**
         * –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä
         * @param {number} seconds - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
         */
        function startTimer(seconds) {
            const display = document.getElementById('timer');
            document.getElementById('timerContainer').style.display = 'block';

            try {
                document.getElementById('startSound').play().catch(e => console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ —Å—Ç–∞—Ä—Ç–∞"));
            } catch (e) {
                console.log("–û—à–∏–±–∫–∞ –∑–≤—É–∫–∞ —Å—Ç–∞—Ä—Ç–∞:", e);
            }

            let remaining = seconds;

            timerInterval = setInterval(() => {
                remaining--;
                let min = Math.floor(remaining / 60);
                let sec = remaining % 60;
                
                sec = sec < 10 ? '0' + sec : sec;
                min = min < 10 ? '0' + min : min;

                display.textContent = `${min}:${sec}`;

                if (remaining <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    display.textContent = "00:00";
                    try {
                        document.getElementById('endSound').play().catch(e => console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫ –∫–æ–Ω—Ü–∞"));
                    } catch (e) {
                         console.log("–û—à–∏–±–∫–∞ –∑–≤—É–∫–∞ –∫–æ–Ω—Ü–∞:", e);
                    }
                    // –í–º–µ—Å—Ç–æ alert() –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª–∏—Ç—å —Ç–∞–π–º–µ—Ä –∫—Ä–∞—Å–Ω—ã–º
                    display.classList.add('text-red-500');
                } else {
                    display.classList.remove('text-red-500');
                }
            }, 1000);
        }
        
        /**
         * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —á–µ–ª–ª–µ–Ω–¥–∂ –≤ localStorage
         */
        function saveChallenge() {
            if (!currentChallengeData.weapon) {
                // –ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å
                return;
            }

            try {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –±—ã–ª–∏ —Å–≤–µ—Ä—Ö—É
                history.unshift(currentChallengeData);
                // –û–≥—Ä–∞–Ω–∏—á–∏–º –∏—Å—Ç–æ—Ä–∏—é, –Ω–∞–ø—Ä–∏–º–µ—Ä, 50 –∑–∞–ø–∏—Å—è–º–∏
                if (history.length > 50) {
                    history.pop();
                }

                localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                loadHistory();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:", e);
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é. –í–æ–∑–º–æ–∂–Ω–æ, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–æ.");
            }
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –¥–ª—è –æ–¥–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏—Å—Ç–æ—Ä–∏–∏
         * @param {object} data - –û–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–∞
         * @returns {string} HTML-—Å—Ç—Ä–æ–∫–∞
         */
        function buildHistoryHTML(data) {
            return `
                <div class="p-3 bg-gray-700 rounded-md shadow text-sm">
                    <p class="font-bold text-yellow-400">${data.task.title} - ${data.map.name} (${data.difficulty})</p>
                    <p class="text-gray-300 text-xs truncate">
                        –°–Ω–∞—Ä—è–∂–µ–Ω–∏–µ: ${data.weapon.name} (${data.ammo.name}), 
                        ${data.helmet.name} (T${data.helmet.tier}), 
                        ${data.vest.name} (T${data.vest.tier})
                    </p>
                </div>
            `;
        }
        
        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑ localStorage –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –µ–µ
         */
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            try {
                const history = JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];

                if (history.length === 0) {
                    historyList.innerHTML = '<p class="text-gray-400 text-center">–ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —á–µ–ª–ª–µ–Ω–¥–∂–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å.</p>';
                    return;
                }

                historyList.innerHTML = history.map(buildHistoryHTML).join('');
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏:", e);
                historyList.innerHTML = '<p class="text-red-500 text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏.</p>';
                localStorage.removeItem(HISTORY_KEY); // –û—á–∏—â–∞–µ–º —Å–ª–æ–º–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            }
        }

        // =====================================================================
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        // =====================================================================
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadHistory);

    </script>
</body>
</html>
